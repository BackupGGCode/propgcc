<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Demo</title>

    <!--script src="http://192.168.1.103/data.js></script-->
</head>

<body>
<script>
<!--
var texta;
var ipaddr;
var rqst;
//var nn = document.getElementById&&!document.all;

function clearText()
{
    texta = document.getElementById("response");
    texta.value = "";
}

function newCORSRequest(method, url)
{
    var xhr = new XMLHttpRequest();
    if ("withCredentials" in xhr)
    {
        // Check if the XMLHttpRequest object has a "withCredentials" property.
        // "withCredentials" only exists on XMLHTTPRequest2 objects.
        xhr.open(method, url, true);
    }
    else if (typeof XDomainRequest != "undefined")
    {
        // Otherwise, check if XDomainRequest.
        // XDomainRequest only exists in IE, and is IE's way of making CORS requests.
        xhr = new XDomainRequest();
        xhr.open(method, url);
    }
    else
    {
        // Otherwise, CORS is not supported by the browser.
        xhr = null;
    }
    return xhr;
}


function testOptions()
{
    texta = document.getElementById("response");
    ipaddr= document.getElementById("ipaddr");
    rqst  = document.getElementById("request");

    var method = "OPTIONS";
    var url = "http://"+ipaddr.value;
    rqst.value = url;

    try {
        var xhr = newCORSRequest(method, url);
        if(!xhr) {
            throw new Error('CORS not supported');
        }

        xhr.onreadystatechange=function() {
            texta.value += "\n" + xhr.readyState + " " + xhr.status + " ";
            texta.value += xhr.statusText + " " + xhr.responseText;
            if (xhr.readyState==4 && xhr.status==200) {
            }
        }

        //xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        //xhr.setRequestHeader("content-type", "text/html");
        //xhr.setRequestHeader("XPOST", "text/plain");
        //xhr.setRequestHeader("XLOAD", "text/plain");

        xhr.send();
    }
    catch (err) {
        texta.value += "\nXHR Request Exception "+err;
    }
}

function testRequest()
{
    texta = document.getElementById("response");
    ipaddr= document.getElementById("ipaddr");
    rqst  = document.getElementById("request");

    var method = "XPOST";
    var url = "http://"+ipaddr.value+"/ld";
    rqst.value = url;

    try {
        var xhr = newCORSRequest(method, url);
        if(!xhr) {
            throw new Error('CORS not supported');
        }

        xhr.onreadystatechange=function() {
            texta.value += "\n" + xhr.readyState + " " + xhr.status + " ";
            texta.value += xhr.statusText + " " + xhr.responseText;
            if (xhr.readyState==4 && xhr.status==200) {
            }
        }

        //xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        //xhr.setRequestHeader("XPOST", "text/plain");
        //xhr.setRequestHeader("content-type", "text/html");
        //xhr.send("XPOST ld");

        xhr.send();
    }
    catch (err) {
        texta.value += "\nXHR Request Exception "+err;
    }
}
-->
</script>
<div>
    <input type="text"   id="ipaddr"  size="16" value="192.168.1.103" />
    <input type="text"   id="request" size="30" value="" />
    <input type="button" id="clr_btn" value="CLR"  onclick='clearText();' />
    <input type="button" id="optsbtn" value="OPTS" onclick='testOptions();' />
    <input type="button" id="testbtn" value="TEST" onclick='testRequest();' />
</div>
<div>
    <textarea id="response" rows="15" cols="70" value="" ></textarea>
    </div>
</body>
</html>
